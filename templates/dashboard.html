<!DOCTYPE html>
<html>
<head>
    <title>Dashboard - Task Manager</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Task Manager</h1>
            <div>
                <span>Welcome, {{ current_user.username }}!</span>
                <a href="{{ url_for('logout') }}" class="btn btn-small">Logout</a>
            </div>
        </div>
        
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="alert alert-{{ category }}">{{ message }}</div>
                {% endfor %}
            {% endif %}
        {% endwith %}
        
        <div class="actions">
            <a href="{{ url_for('create_task') }}" class="btn">+ New Task</a>
            
            <form method="GET" class="filter-form">
                <select name="status" onchange="this.form.submit()">
                    <option value="">All Status</option>
                    <option value="pending" {% if status_filter == 'pending' %}selected{% endif %}>Pending</option>
                    <option value="in_progress" {% if status_filter == 'in_progress' %}selected{% endif %}>In Progress</option>
                    <option value="completed" {% if status_filter == 'completed' %}selected{% endif %}>Completed</option>
                </select>
            </form>
        </div>
        
        <div class="task-list">
            {% if tasks.items %}
                {% for task in tasks.items %}
                    <div class="task-card">
                        <div class="task-header">
                            <h3>{{ task.title }}</h3>
                            {% if task.is_urgent %}
                                <span class="badge urgent">Urgent</span>
                            {% endif %}
                        </div>
                        
                        <div class="task-details">
                            <span class="status" style="color: {{ task.status_color }}">
                                Status: {{ task.status.replace('_', ' ').title() }}
                            </span>
                            <span>Due: {{ task.due_date.strftime('%Y-%m-%d') }}</span>
                            <span class="calculated">
                                Days Remaining: {{ task.days_remaining }}
                            </span>
                        </div>
                        
                        <div class="task-actions">
                            <a href="{{ url_for('edit_task', task_id=task.id) }}" class="btn-small">Edit</a>
                            <a href="{{ url_for('delete_task', task_id=task.id) }}" 
                               class="btn-small btn-danger" 
                               onclick="return confirm('Are you sure?')">Delete</a>
                        </div>
                    </div>
                {% endfor %}
                
                <!-- Pagination -->
                <div class="pagination">
                    {% if tasks.has_prev %}
                        <a href="{{ url_for('dashboard', page=tasks.prev_num, status=status_filter) }}">Previous</a>
                    {% endif %}
                    
                    <span>Page {{ tasks.page }} of {{ tasks.pages }}</span>
                    
                    {% if tasks.has_next %}
                        <a href="{{ url_for('dashboard', page=tasks.next_num, status=status_filter) }}">Next</a>
                    {% endif %}
                </div>
            {% else %}
                <p class="no-tasks">No tasks found. Create your first task!</p>
            {% endif %}
        </div>
    </div>
</body>
</html>